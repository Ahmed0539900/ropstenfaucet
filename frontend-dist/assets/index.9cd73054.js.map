{"version":3,"file":"index.9cd73054.js","sources":["../../frontend/vite/modulepreload-polyfill","../../frontend/src/components/AddressForm.vue","../../frontend/src/components/Stats.vue","../../frontend/src/App.vue","../../frontend/src/formatters.js","../../frontend/src/main.js"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","<template>\n  <div style=\"{ opacity: isLoading ? 0.5 : 1 }\">\n    <form @submit.prevent=\"giveMe\" :disabled=\"isLoading\">\n      <input v-model=\"address\" @input=\"reset\" :disabled=\"isLoading\">\n      <button type=\"submit\" :disabled=\"isLoading || !isValid\">Gimme</button>\n    </form>\n\n    <div v-if=\"state == 'success'\">\n      Okay! Sent {{ $format18(amountSent) }} to {{ addressSent }} with tx <a :href=\"'https://ropsten.etherscan.io/tx/' + tx\">{{ tx }}</a>.\n    </div>\n\n    <div v-else-if=\"state == 'limited'\">\n      Oops! Limit engaged, please retry in {{ liftInHr }} at {{ liftAtHr }}\n    </div>\n\n    <div v-else-if=\"state == 'empty'\">\n      Oops! Faucet empty. <a href=\"https://twitter.com/egorfine\">Hit me up on Twitter</a> so that I mine some more.\n    </div>\n\n    <div v-else-if=\"state == 'fail'\">\n      {{ message }}\n    </div>\n  </div>\n</template>\n\n<script>\nimport dayjs from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\ndayjs.extend(relativeTime);\ndayjs.extend(localizedFormat)\n\nexport default {\n  data() {\n    return {\n      // isLoading: false,\n      state: 'idle',\n\n      message: null,\n      address: '',\n      addressSent: '',\n      amountSent: 0n,\n      tx: null,\n      liftAtUnixtime: 0\n    };\n  },\n\n  computed: {\n    isLoading() {\n      this.state == 'loading';\n    },\n\n    isValid() {\n      return this.address.startsWith('0x') && this.address.length == 42 && this.address.substr(2).match(/^[0-9A-Fa-f]+$/);\n    },\n\n    liftInHr() {\n      return dayjs().to(dayjs.unix(this.liftAtUnixtime));\n    },\n\n    liftAtHr() {\n      return dayjs.unix(this.liftAtUnixtime).format('LLL');\n    }\n  },\n\n  methods: {\n    reset() {\n      this.state = 'idle';\n      this.tx = null;\n      this.message = '';\n    },\n\n    async giveMe() {\n      this.state = 'loading';\n\n      this.tx = null;\n      this.message = '';\n\n      const options = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'same-origin',\n        body: JSON.stringify({ address: this.address })\n      };\n\n      let json = null;\n\n      try {\n        const response = await window.fetch(this.$root.urlPrefix + '/api/gimme/', options);\n        json = await response.json();\n      } catch (e) {\n        // console.error(e);\n      }\n\n      if (!json) {\n        this.state = 'fail';\n        this.message = \"Failure :-(\";\n        return;\n      }\n\n      if (!json.success) {\n        if (json.isLimited) {\n          this.state = 'limited';\n          this.liftAtUnixtime = json.liftAtUnixtime;\n\n        } else if (json.isEmpty) {\n          this.state = 'empty';\n\n        } else {\n          this.state = 'fail';\n          this.message = json.message || \"Oops\";\n        }\n\n        return;\n      }\n\n      this.state = 'success';\n\n      this.tx = json.tx;\n      this.addressSent = json.address;\n      this.amountSent = BigInt(json.amount);\n      this.address = '';\n    }\n  }\n};\n</script>\n","<template>\n  <h1>Stats</h1>\n\n  <div v-if=\"isLoading\">\n    Loading...\n  </div>\n\n  <div v-else>\n    Faucet balance: {{ $format18(balance) }}<br/>\n    Faucet address: <a :href=\"'https://ropsten.etherscan.io/address/' + address\">{{ address }}</a><br/>\n    Giving today per address: {{ $format18(weiPerAddress) }}\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      isLoading: true,\n      balance: 0,\n      weiPerAddress: 0,\n      address: ''\n    };\n  },\n\n  mounted() {\n    this.loadStats();\n    setInterval(() => this.loadStats(), 15000);\n  },\n\n  methods: {\n    async loadStats() {\n      this.isLoading = true;\n\n      let statusCode = null;\n      let json = null;\n\n      try {\n        const response = await window.fetch(this.$root.urlPrefix + '/api/stats/');\n        statusCode = response.status;\n        json = await response.json();\n      } catch (e) {\n        // console.error(e);\n      }\n\n      this.isLoading = false;\n\n      if (!json) {\n        return;\n      }\n\n      this.balance = BigInt(json.balance);\n      this.weiPerAddress = BigInt(json.weiPerAddress);\n      this.address = json.address;\n    }\n  }\n};\n</script>\n","<script setup>\nimport AddressForm from './components/AddressForm.vue'\nimport Stats from './components/Stats.vue'\n</script>\n\n<template>\n  <h1>Ropsten faucet</h1>\n  <Stats/>\n  <hr/>\n  <AddressForm/>\n  <hr/>\n  FIXME footer and copy\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      urlPrefix: import.meta.env.PROD ? '' : 'http://localhost:3090'\n    };\n  }\n};\n</script>\n","const formatter = new Intl.NumberFormat('en-US', { useGrouping: true, minimumFractionDigits: 4 });\n\nexport function format18(value) {\n  const b = BigInt(value) / 10n ** 14n;\n  return formatter.format(Number(b.toString()) / 10**4);\n}\n\nexport default {\n  install: (app) => {\n    app.config.globalProperties.$format18 = (value, defaultValue = '') => {\n      if ((value ?? null) === null) {\n        return defaultValue;\n      }\n\n      return format18(value);\n    };\n  }\n};\n","import { createApp } from 'vue'\nimport App from './App.vue'\nimport formatters from './formatters.js';\n\ncreateApp(App).use(formatters).mount('#app')\n"],"names":["relList","document","createElement","supports","link","querySelectorAll","MutationObserver","mutations","mutation","type","node","addedNodes","tagName","rel","observe","childList","subtree","ep","fetchOpts","script","integrity","referrerpolicy","referrerPolicy","crossorigin","credentials","getFetchOpts","href","p","dayjs","extend","relativeTime","localizedFormat","data","state","message","address","addressSent","amountSent","tx","liftAtUnixtime","computed","isLoading","isValid","this","startsWith","length","substr","match","liftInHr","to","unix","liftAtHr","format","methods","reset","options","method","headers","body","JSON","stringify","json","response","window","fetch","$root","urlPrefix","e","success","BigInt","amount","isLimited","isEmpty","$data","_createElementBlock","onSubmit","_cache","onInput","_createTextVNode","balance","weiPerAddress","mounted","loadStats","statusCode","status","_hoisted_5","formatter","Intl","NumberFormat","useGrouping","minimumFractionDigits","install","app","config","globalProperties","$format18","value","defaultValue","b","Number","toString","format18","createApp","App","use","formatters","mount"],"mappings":"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"}